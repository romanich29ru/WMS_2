<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫–ª–∞–¥–∞ - —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π XLS</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #9b59b6;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f0f4f8;
            color: var(--text-color);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        /* ========== –†–ï–ñ–ò–ú –û–ë–©–ï–ì–û –û–ë–ó–û–†–ê ========== */
        .overview-mode {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .control-panel {
            background-color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #e1e8ed;
            flex-shrink: 0;
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .app-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .operator-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .operator-name {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
            min-width: 150px;
        }

        .control-content {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
        }

        .alley-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alley-label {
            font-weight: 600;
            color: var(--primary-color);
            white-space: nowrap;
        }

        .alley-dropdown {
            padding: 10px 15px;
            border: 2px solid var(--secondary-color);
            border-radius: var(--border-radius);
            background-color: white;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 120px;
            cursor: pointer;
        }

        .alley-dropdown:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .global-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8fafc;
            border-radius: var(--border-radius);
            min-width: 100px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .total-stat .stat-value { color: var(--secondary-color); }
        .checked-stat .stat-value { color: var(--success-color); }
        .discrepancy-stat .stat-value { color: var(--warning-color); }
        .problem-stat .stat-value { color: var(--info-color); }

        /* –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            width: 100%;
        }

        .control-btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            flex: 1;
            min-width: 120px;
        }

        .start-inspection-btn {
            background-color: var(--success-color);
            color: white;
        }

        .start-inspection-btn:hover {
            background-color: #219653;
            transform: translateY(-2px);
        }

        .import-btn {
            background-color: var(--info-color);
            color: white;
        }

        .import-btn:hover {
            background-color: #8e44ad;
            transform: translateY(-2px);
        }

        .export-btn {
            background-color: var(--warning-color);
            color: white;
        }

        .export-btn:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }

        /* –û–±–∑–æ—Ä —Å–µ–∫—Ü–∏–π */
        .sections-overview {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f8fafc;
        }

        .overview-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .section-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .section-card.active {
            border-color: var(--secondary-color);
            background-color: rgba(52, 152, 219, 0.05);
        }

        .section-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-card-title {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .section-card-status {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .status-not-started { background-color: #e2e8f0; color: #475569; }
        .status-in-progress { background-color: #dbeafe; color: #1e40af; }
        .status-completed { background-color: #dcfce7; color: #166534; }
        .status-with-issues { background-color: #fef3c7; color: #92400e; }

        .section-card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        .section-card-stat {
            display: flex;
            justify-content: space-between;
        }

        .section-card-stat-label {
            color: #64748b;
        }

        .section-card-stat-value {
            font-weight: 600;
        }

        .section-card-progress {
            height: 6px;
            background-color: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .section-card-progress-fill {
            height: 100%;
            background-color: var(--success-color);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* ========== –†–ï–ñ–ò–ú –ü–†–û–í–ï–†–ö–ò –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù ========== */
        .inspection-mode {
            height: 100vh;
            width: 100vw;
            display: none;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            background-color: white;
            z-index: 1000;
        }

        .inspection-header {
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .inspection-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .exit-inspection-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .exit-inspection-btn:hover {
            background-color: #c0392b;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—É—Å–µ–ª–∏ */
        .inspection-carousel-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .inspection-sections-carousel {
            display: flex;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.22, 0.61, 0.36, 1);
            will-change: transform;
        }

        .inspection-section-slide {
            flex: 0 0 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .inspection-section-header {
            padding: 12px 15px;
            background-color: white;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .inspection-section-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .inspection-section-counter {
            font-size: 1rem;
            color: #64748b;
            font-weight: 600;
        }

        .inspection-rack-container {
            flex: 1;
            padding: 15px;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .inspection-rack {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
        }

        .inspection-tier-row {
            display: flex;
            margin-bottom: 4px;
            width: 100%;
        }

        .inspection-tier-label {
            width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .inspection-cells-container {
            display: flex;
            flex: 1;
            justify-content: center;
            flex-wrap: wrap;
            gap: 6px;
        }

        .inspection-cell {
            width: 60px;
            height: 60px;
            border: 2px solid #ddd;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        .inspection-cell:active {
            transform: scale(0.95);
        }

        .inspection-cell-address {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .inspection-cell-position {
            font-size: 0.7rem;
            color: #777;
        }

        /* –¶–≤–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π —è—á–µ–µ–∫ */
        .inspection-cell-unchecked {
            background-color: var(--success-color);
            color: white;
        }

        .inspection-cell-checked-empty {
            background-color: var(--secondary-color);
            color: white;
        }

        .inspection-cell-discrepancy {
            background-color: var(--warning-color);
            color: white;
        }

        .inspection-cell-problem {
            background-color: var(--info-color);
            color: white;
        }

        .inspection-cell-skipped {
            background-color: #95a5a6;
            color: white;
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* –í—ã–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω */
        .inspection-tier-picking {
            background-color: rgba(231, 76, 60, 0.05);
        }

        .inspection-tier-upper {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .inspection-tier-label.picking {
            color: var(--danger-color);
        }

        .inspection-tier-label.upper {
            color: var(--secondary-color);
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–≤–∞–π–ø–∞ */
        .swipe-indicators {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 10;
        }

        .swipe-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .swipe-indicator.active {
            background-color: var(--secondary-color);
            transform: scale(1.3);
        }

        .swipe-hint {
            position: absolute;
            bottom: 50px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--secondary-color);
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0;
            animation: fadeInOut 3s ease-in-out 1s 3;
        }

        .swipe-hint.hidden {
            display: none;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.7; }
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞) */
        .carousel-nav {
            display: none;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            transition: var(--transition);
        }

        .carousel-nav:hover {
            background-color: rgba(52, 152, 219, 1);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-nav.prev {
            left: 15px;
        }

        .carousel-nav.next {
            right: 15px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-title {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.2rem;
            text-align: center;
        }

        .modal-address {
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1rem;
            text-align: center;
            padding: 10px;
            background-color: #f8fafc;
            border-radius: var(--border-radius);
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .modal-option {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .modal-option:hover {
            transform: translateX(3px);
        }

        .modal-option.empty {
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }

        .modal-option.occupied {
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .modal-option.problem {
            border-color: var(--info-color);
            color: var(--info-color);
        }

        .modal-option.skip {
            border-color: #95a5a6;
            color: #95a5a6;
        }

        .option-icon {
            margin-right: 8px;
            font-size: 1rem;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-cancel {
            background-color: #95a5a6;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            color: white;
            font-weight: 600;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.5s ease;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
        }

        .notification.info {
            background-color: var(--info-color);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞ */
        .import-modal {
            max-width: 500px;
        }

        .import-content {
            margin: 20px 0;
        }

        .import-dropzone {
            border: 2px dashed #3498db;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .import-dropzone:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .import-dropzone.dragover {
            border-color: var(--success-color);
            background-color: rgba(39, 174, 96, 0.1);
        }

        .import-dropzone-icon {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 10px;
        }

        .import-dropzone-text {
            font-size: 1rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .import-dropzone-hint {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .import-file-input {
            display: none;
        }

        .import-file-name {
            padding: 10px;
            background-color: #f8fafc;
            border-radius: var(--border-radius);
            margin: 10px 0;
            display: none;
            align-items: center;
            justify-content: space-between;
        }

        .import-file-name.show {
            display: flex;
        }

        .import-progress {
            width: 100%;
            height: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }

        .import-progress.show {
            display: block;
        }

        .import-progress-bar {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .modal-buttons-row {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn.primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .modal-btn.secondary {
            background-color: #95a5a6;
            color: white;
        }

        .modal-btn.success {
            background-color: var(--success-color);
            color: white;
        }

        /* –°—Ç–∞—Ç—É—Å –∏–º–ø–æ—Ä—Ç–∞ */
        .import-status {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: var(--border-radius);
            display: none;
        }

        .import-status.show {
            display: block;
        }

        .import-status-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .import-status-list {
            list-style: none;
        }

        .import-status-item {
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
        }

        .import-status-item:last-child {
            border-bottom: none;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (min-width: 768px) {
            .carousel-nav {
                display: block;
            }
            
            .inspection-cell {
                width: 70px;
                height: 70px;
            }
            
            .inspection-rack {
                max-width: 600px;
            }
        }

        @media (max-width: 480px) {
            .inspection-cell {
                width: 50px;
                height: 50px;
            }
            
            .inspection-cell-address {
                font-size: 0.7rem;
            }
            
            .inspection-tier-label {
                width: 40px;
                font-size: 0.8rem;
            }
            
            .control-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .global-stats {
                width: 100%;
                justify-content: space-between;
            }
            
            .stat-item {
                min-width: 80px;
                padding: 6px 8px;
            }
            
            .sections-grid {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .control-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- –†–ï–ñ–ò–ú –û–ë–©–ï–ì–û –û–ë–ó–û–†–ê -->
    <div class="overview-mode" id="overview-mode">
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="control-panel">
            <div class="control-header">
                <h1 class="app-title">üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–ª–∞–¥—Å–∫–∏—Ö —è—á–µ–µ–∫</h1>
                <div class="operator-info">
                    <input type="text" id="operator-name" class="operator-name" placeholder="–ò–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞" maxlength="50">
                </div>
            </div>
            <div class="control-content">
                <div class="alley-selector">
                    <span class="alley-label">–ê–ª–ª–µ—è:</span>
                    <select id="alley-select" class="alley-dropdown">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </select>
                </div>
                <div class="global-stats">
                    <div class="stat-item total-stat">
                        <span class="stat-label">–í—Å–µ–≥–æ</span>
                        <span class="stat-value" id="total-cells">0</span>
                    </div>
                    <div class="stat-item checked-stat">
                        <span class="stat-label">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
                        <span class="stat-value" id="checked-cells">0</span>
                    </div>
                    <div class="stat-item discrepancy-stat">
                        <span class="stat-label">–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è</span>
                        <span class="stat-value" id="discrepancy-cells">0</span>
                    </div>
                    <div class="stat-item problem-stat">
                        <span class="stat-label">–ü—Ä–æ–±–ª–µ–º—ã</span>
                        <span class="stat-value" id="problem-cells">0</span>
                    </div>
                </div>
            </div>
            <div class="control-buttons">
                <button class="control-btn start-inspection-btn" id="start-inspection-btn">
                    ‚ñ∂ –ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
                </button>
                <button class="control-btn import-btn" id="import-btn">
                    üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å XLS
                </button>
                <button class="control-btn export-btn" id="export-btn">
                    üíæ –≠–∫—Å–ø–æ—Ä—Ç CSV
                </button>
            </div>
        </div>

        <!-- –û–±–∑–æ—Ä —Å–µ–∫—Ü–∏–π -->
        <div class="sections-overview">
            <h2 class="overview-title" id="overview-alley-title">–ê–ª–ª–µ—è A01 - –°–µ–∫—Ü–∏–∏</h2>
            <div class="sections-grid" id="sections-grid">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–µ–∫—Ü–∏–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- –†–ï–ñ–ò–ú –ü–†–û–í–ï–†–ö–ò –ù–ê –í–ï–°–¨ –≠–ö–†–ê–ù -->
    <div class="inspection-mode" id="inspection-mode">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
        <div class="inspection-header">
            <div class="inspection-title" id="inspection-alley-title">–ê–ª–ª–µ—è A01 - –ü—Ä–æ–≤–µ—Ä–∫–∞</div>
            <button class="exit-inspection-btn" id="exit-inspection-btn">
                ‚Üê –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
            </button>
        </div>

        <!-- –ö–∞—Ä—É—Å–µ–ª—å —Å–µ–∫—Ü–∏–π -->
        <div class="inspection-carousel-container" id="carousel-container">
            <!-- –ö–∞—Ä—É—Å–µ–ª—å -->
            <div class="inspection-sections-carousel" id="sections-carousel">
                <!-- –°–µ–∫—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏ (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞) -->
            <button class="carousel-nav prev" id="carousel-prev">‚Äπ</button>
            <button class="carousel-nav next" id="carousel-next">‚Ä∫</button>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–≤–∞–π–ø–∞ -->
            <div class="swipe-indicators" id="swipe-indicators">
                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å–≤–∞–π–ø–∞ -->
            <div class="swipe-hint" id="swipe-hint">–°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –∏–ª–∏ –≤–ø—Ä–∞–≤–æ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —è—á–µ–π–∫–∏ -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">–°–æ—Å—Ç–æ—è–Ω–∏–µ —è—á–µ–π–∫–∏</h3>
            <div class="modal-address" id="modal-address">A01-01-01-A</div>
            <div class="modal-options">
                <div class="modal-option empty" data-status="checked-empty">
                    <span class="option-icon">‚úì</span>
                    <span>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—É—Å—Ç–∞—è</span>
                </div>
                <div class="modal-option occupied" data-status="discrepancy">
                    <span class="option-icon">‚ö†</span>
                    <span>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–Ω—è—Ç–∞</span>
                </div>
                <div class="modal-option problem" data-status="problem">
                    <span class="option-icon">!</span>
                    <span>–î—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞</span>
                </div>
                <div class="modal-option skip" data-status="skipped">
                    <span class="option-icon">‚Üí</span>
                    <span>–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-cancel" id="modal-cancel">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞ XLS -->
    <div class="modal-overlay" id="import-modal-overlay">
        <div class="modal import-modal">
            <h3 class="modal-title">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ XLS —Ñ–∞–π–ª–∞</h3>
            <div class="import-content">
                <div class="import-dropzone" id="import-dropzone">
                    <div class="import-dropzone-icon">üìÅ</div>
                    <div class="import-dropzone-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ XLS/XLSX —Ñ–∞–π–ª —Å—é–¥–∞</div>
                    <div class="import-dropzone-hint">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
                    <input type="file" id="xls-file-input" class="import-file-input" accept=".xls,.xlsx,.csv">
                </div>
                
                <div class="import-file-name" id="import-file-name">
                    <span id="selected-file-name">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                    <button class="modal-btn secondary" id="clear-file-btn">‚úï</button>
                </div>
                
                <div class="import-progress" id="import-progress">
                    <div class="import-progress-bar" id="import-progress-bar"></div>
                </div>
                
                <div class="import-status" id="import-status">
                    <div class="import-status-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞:</div>
                    <ul class="import-status-list" id="import-status-list">
                        <!-- –°—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </ul>
                </div>
            </div>
            <div class="modal-buttons-row">
                <button class="modal-btn secondary" id="import-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" id="import-start-btn" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification"></div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ SheetJS -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.mini.min.js"></script>

    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ ==========
        let currentAlley = 'A01';
        let currentSectionIndex = 0;
        let warehousesData = {};
        let selectedCell = null;
        let selectedCellElement = null;
        let isMobile = window.innerWidth < 768;
        let isInspecting = false;
        
        // –î–∞–Ω–Ω—ã–µ –∏–∑ XLS —Ñ–∞–π–ª–∞
        let wmsData = {
            lastImportDate: null,
            fileInfo: null,
            cellsData: {} // –∫–ª—é—á: –∞–¥—Ä–µ—Å —è—á–µ–π–∫–∏ (A01-01-01-A), –∑–Ω–∞—á–µ–Ω–∏–µ: —Å—Ç–∞—Ç—É—Å –∏–∑ WMS
        };

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const tierOrder = ['15', '14', '13', '12', '11', '10', '03', '02', '01'];
        const pickingTiers = ['02', '03'];
        const upperTiers = ['10', '11', '12', '13', '14', '15'];
        const positions = ['A', 'B', 'C'];
        const totalSections = 15;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...');
            initAlleysDropdown();
            generateWarehouseData();
            setupEventListeners();
            updateOverviewDisplay();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadSavedData();
            
            console.log('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –∞–ª–ª–µ–π
        function initAlleysDropdown() {
            const alleySelect = document.getElementById('alley-select');
            alleySelect.innerHTML = '';
            
            for (let i = 1; i <= 14; i++) {
                const alley = `A${i.toString().padStart(2, '0')}`;
                const option = document.createElement('option');
                option.value = alley;
                option.textContent = alley;
                alleySelect.appendChild(option);
            }
            
            alleySelect.value = currentAlley;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function generateWarehouseData() {
            warehousesData = {};
            
            for (let alleyNum = 1; alleyNum <= 14; alleyNum++) {
                const alley = `A${alleyNum.toString().padStart(2, '0')}`;
                warehousesData[alley] = {};
                
                for (let sectionNum = 1; sectionNum <= totalSections; sectionNum++) {
                    const section = sectionNum.toString().padStart(2, '0');
                    warehousesData[alley][section] = {
                        cells: [],
                        checkedTime: null,
                        operator: ''
                    };
                    
                    for (const tier of tierOrder) {
                        for (const position of positions) {
                            const cell = {
                                id: `${alley}-${section}-${tier}-${position}`,
                                alley: alley,
                                section: section,
                                tier: tier,
                                position: position,
                                systemStatus: 'empty',
                                actualStatus: null,
                                checked: false,
                                checkTime: null,
                                comment: '',
                                operator: '',
                                discrepancy: false
                            };
                            
                            warehousesData[alley][section].cells.push(cell);
                        }
                    }
                }
            }
            console.log('–î–∞–Ω–Ω—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã:', warehousesData[currentAlley]);
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –ò –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• ==========
        function loadSavedData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
            const savedData = localStorage.getItem('warehouseInspectionData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ç–µ–∫—É—â–∏–º–∏
                    for (const alley in parsedData) {
                        if (warehousesData[alley]) {
                            for (const section in parsedData[alley]) {
                                if (warehousesData[alley][section]) {
                                    // –û–±–Ω–æ–≤–ª—è–µ–º —è—á–µ–π–∫–∏
                                    parsedData[alley][section].cells.forEach(savedCell => {
                                        const existingCell = warehousesData[alley][section].cells.find(
                                            cell => cell.id === savedCell.id
                                        );
                                        if (existingCell) {
                                            Object.assign(existingCell, savedCell);
                                        }
                                    });
                                    
                                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
                                    warehousesData[alley][section].checkedTime = parsedData[alley][section].checkedTime;
                                    warehousesData[alley][section].operator = parsedData[alley][section].operator;
                                }
                            }
                        }
                    }
                    console.log('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ WMS
            const savedWMSData = localStorage.getItem('warehouseWMSData');
            if (savedWMSData) {
                try {
                    wmsData = JSON.parse(savedWMSData);
                    applyWMSDataToWarehouse();
                    console.log('–î–∞–Ω–Ω—ã–µ WMS –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö WMS:', error);
                }
            }
        }

        function saveData() {
            try {
                localStorage.setItem('warehouseInspectionData', JSON.stringify(warehousesData));
                localStorage.setItem('warehouseWMSData', JSON.stringify(wmsData));
                console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // ========== –ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• –ò–ó XLS ==========
        function openImportModal() {
            console.log('–û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–º–ø–æ—Ä—Ç–∞');
            document.getElementById('import-modal-overlay').classList.add('show');
            resetImportForm();
        }

        function closeImportModal() {
            document.getElementById('import-modal-overlay').classList.remove('show');
        }

        function resetImportForm() {
            document.getElementById('selected-file-name').textContent = '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';
            document.getElementById('import-file-name').classList.remove('show');
            document.getElementById('import-progress').classList.remove('show');
            document.getElementById('import-progress-bar').style.width = '0%';
            document.getElementById('import-status').classList.remove('show');
            document.getElementById('import-status-list').innerHTML = '';
            document.getElementById('import-start-btn').disabled = true;
            document.getElementById('xls-file-input').value = '';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        function handleFileSelect(file) {
            if (!file) return;
            
            const fileName = file.name;
            const fileSize = (file.size / 1024 / 1024).toFixed(2); // –†–∞–∑–º–µ—Ä –≤ MB
            
            console.log('–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª:', fileName, '–†–∞–∑–º–µ—Ä:', fileSize, 'MB');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
            const validExtensions = ['.xls', '.xlsx', '.csv'];
            const fileExtension = fileName.slice(fileName.lastIndexOf('.')).toLowerCase();
            
            if (!validExtensions.includes(fileExtension)) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .xls, .xlsx –∏–ª–∏ .csv', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 10 MB)
            if (file.size > 10 * 1024 * 1024) {
                showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 MB', 'error');
                return;
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
            document.getElementById('selected-file-name').textContent = `${fileName} (${fileSize} MB)`;
            document.getElementById('import-file-name').classList.add('show');
            document.getElementById('import-start-btn').disabled = false;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
            window.selectedFile = file;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ XLS —Ñ–∞–π–ª–∞
        async function parseXLSFile(file) {
            return new Promise((resolve, reject) => {
                try {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            
                            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            
                            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ JSON
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            console.log('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω, —Å—Ç—Ä–æ–∫:', jsonData.length);
                            resolve(jsonData);
                        } catch (error) {
                            reject(new Error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞: ' + error.message));
                        }
                    };
                    
                    reader.onerror = function() {
                        reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
                    };
                    
                    reader.readAsArrayBuffer(file);
                } catch (error) {
                    reject(error);
                }
            });
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ XLS –≤ —Ñ–æ—Ä–º–∞—Ç —Å–∏—Å—Ç–µ–º—ã
        function processXLSData(xlsData) {
            console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö XLS...');
            
            const processedData = {};
            let totalRows = 0;
            let validRows = 0;
            let errors = [];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –∫–æ–ª–æ–Ω–æ–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
            let headerRow = null;
            let cellNameIndex = -1;
            let statusIndex = -1;
            let alleyIndex = -1;
            
            // –ò—â–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
            for (let i = 0; i < Math.min(5, xlsData.length); i++) {
                const row = xlsData[i];
                if (Array.isArray(row)) {
                    for (let j = 0; j < row.length; j++) {
                        const cellValue = String(row[j] || '').toLowerCase();
                        
                        if (cellValue.includes('–Ω–∞–∑–≤–∞–Ω–∏–µ') && cellValue.includes('—è—á–µ–π–∫–∏')) {
                            cellNameIndex = j;
                        }
                        if (cellValue.includes('—Å—Ç–∞—Ç—É—Å')) {
                            statusIndex = j;
                        }
                        if (cellValue.includes('–∞–ª–ª–µ') || cellValue.includes('–Ω–æ–º–µ—Ä –∞–ª–ª–µ–∏')) {
                            alleyIndex = j;
                        }
                    }
                    
                    // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
                    if (cellNameIndex !== -1 && statusIndex !== -1) {
                        headerRow = i;
                        break;
                    }
                }
            }
            
            if (cellNameIndex === -1 || statusIndex === -1) {
                throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ñ–∞–π–ª–µ. –¢—Ä–µ–±—É—é—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∏: "–ù–∞–∑–≤–∞–Ω–∏–µ –Ø—á–µ–π–∫–∏" –∏ "–°—Ç–∞—Ç—É—Å"');
            }
            
            console.log('–ù–∞–π–¥–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏:', { cellNameIndex, statusIndex, alleyIndex, headerRow });
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            for (let i = (headerRow || 0) + 1; i < xlsData.length; i++) {
                const row = xlsData[i];
                if (!Array.isArray(row) || row.length === 0) continue;
                
                totalRows++;
                
                try {
                    const cellName = String(row[cellNameIndex] || '').trim();
                    const status = String(row[statusIndex] || '').trim();
                    const alley = alleyIndex !== -1 ? String(row[alleyIndex] || '').trim() : '';
                    
                    if (!cellName || !status) {
                        errors.push(`–°—Ç—Ä–æ–∫–∞ ${i+1}: –ø—Ä–æ–ø—É—â–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`);
                        continue;
                    }
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —è—á–µ–π–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç —Å–∏—Å—Ç–µ–º—ã
                    const parsedCell = parseCellName(cellName, alley);
                    
                    if (!parsedCell) {
                        errors.push(`–°—Ç—Ä–æ–∫–∞ ${i+1}: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–∞–∑–≤–∞–Ω–∏—è —è—á–µ–π–∫–∏: ${cellName}`);
                        continue;
                    }
                    
                    const cellId = `${parsedCell.alley}-${parsedCell.section}-${parsedCell.tier}-${parsedCell.position}`;
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç–∞—Ç—É—Å
                    const systemStatus = convertStatus(status);
                    
                    processedData[cellId] = {
                        cellId: cellId,
                        originalName: cellName,
                        systemStatus: systemStatus,
                        parsedData: parsedCell,
                        rawData: {
                            status: status,
                            alley: alley
                        }
                    };
                    
                    validRows++;
                    
                } catch (error) {
                    errors.push(`–°—Ç—Ä–æ–∫–∞ ${i+1}: ${error.message}`);
                }
            }
            
            console.log(`–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: ${validRows}/${totalRows}, –æ—à–∏–±–æ–∫: ${errors.length}`);
            
            return {
                processedData: processedData,
                stats: {
                    totalRows: totalRows,
                    validRows: validRows,
                    errorRows: errors.length
                },
                errors: errors
            };
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏—è —è—á–µ–π–∫–∏
        function parseCellName(cellName, alleyFromData) {
            // –ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞: "OS A5-15-11-C"
            // –ò–ª–∏: "OS A 005 011 045"
            
            const cleanedName = cellName.replace(/\s+/g, ' ').trim();
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω 1: OS A5-15-11-C
            const pattern1 = /OS\s+([A-Z])(\d{1,2})-(\d{1,2})-(\d{1,2})-([A-C])/i;
            // –ü–∞—Ç—Ç–µ—Ä–Ω 2: OS A 005 011 045
            const pattern2 = /OS\s+([A-Z])\s+(\d{3})\s+(\d{3})\s+(\d{3})/i;
            
            let alley = '';
            let section = '';
            let tier = '';
            let position = '';
            
            const match1 = cleanedName.match(pattern1);
            const match2 = cleanedName.match(pattern2);
            
            if (match1) {
                alley = match1[1].toUpperCase() + match1[2].padStart(2, '0'); // A5 ‚Üí A05
                section = match1[3].padStart(2, '0'); // 15 ‚Üí 15
                tier = match1[4].padStart(2, '0'); // 11 ‚Üí 11
                position = match1[5].toUpperCase(); // C ‚Üí C
            } else if (match2) {
                alley = match2[1].toUpperCase() + match2[2].padStart(2, '0').slice(-2); // 005 ‚Üí 05
                section = match2[3].padStart(2, '0'); // 011 ‚Üí 11
                tier = match2[4].padStart(2, '0'); // 045 ‚Üí 45
                // –î–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ —Å –≥–ª—É–±–∏–Ω–æ–π –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ –≥–ª—É–±–∏–Ω–µ
                const depth = parseInt(match2[4]);
                position = depth <= 49 ? 'A' : depth <= 50 ? 'B' : 'C';
            } else {
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –ø–æ —à–∞–±–ª–æ–Ω–∞–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–ª–µ—é –∏–∑ –¥–∞–Ω–Ω—ã—Ö
                if (alleyFromData) {
                    const alleyMatch = alleyFromData.match(/([A-Z])(\d{1,2})/i);
                    if (alleyMatch) {
                        alley = alleyMatch[1].toUpperCase() + alleyMatch[2].padStart(2, '0');
                        
                        // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                        const numbers = cellName.match(/\d+/g);
                        if (numbers && numbers.length >= 3) {
                            section = numbers[0].padStart(2, '0').slice(-2);
                            tier = numbers[1].padStart(2, '0').slice(-2);
                            position = numbers[2] === '49' ? 'A' : numbers[2] === '50' ? 'B' : 'C';
                        }
                    }
                }
                
                if (!alley) {
                    return null;
                }
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            if (!alley.match(/^A\d{2}$/) || 
                !section.match(/^\d{2}$/) || 
                !tier.match(/^\d{2}$/) || 
                !['A', 'B', 'C'].includes(position)) {
                return null;
            }
            
            return {
                alley: alley,
                section: section,
                tier: tier,
                position: position
            };
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function convertStatus(status) {
            const statusLower = status.toLowerCase();
            
            if (statusLower.includes('—Å–≤–æ–±–æ–¥') || statusLower.includes('–ø—É—Å—Ç') || statusLower === 'empty') {
                return 'empty';
            } else if (statusLower.includes('–∑–∞–Ω—è—Ç') || statusLower.includes('–∑–∞–ø–æ–ª–Ω') || statusLower === 'occupied') {
                return 'occupied';
            } else {
                return 'unknown';
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö WMS –∫ warehousesData
        function applyWMSDataToWarehouse() {
            console.log('–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö WMS...');
            
            let updatedCells = 0;
            let notFoundCells = 0;
            
            for (const cellId in wmsData.cellsData) {
                const wmsCell = wmsData.cellsData[cellId];
                const parts = cellId.split('-');
                
                if (parts.length !== 4) continue;
                
                const [alley, section, tier, position] = parts;
                
                if (warehousesData[alley] && warehousesData[alley][section]) {
                    const cell = warehousesData[alley][section].cells.find(
                        c => c.tier === tier && c.position === position
                    );
                    
                    if (cell) {
                        cell.systemStatus = wmsCell.systemStatus;
                        updatedCells++;
                    } else {
                        notFoundCells++;
                    }
                } else {
                    notFoundCells++;
                }
            }
            
            console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–æ —è—á–µ–µ–∫: ${updatedCells}, –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: ${notFoundCells}`);
            return { updatedCells, notFoundCells };
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞
        async function startImport() {
            const file = window.selectedFile;
            if (!file) {
                showNotification('–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
                return;
            }
            
            const progressBar = document.getElementById('import-progress-bar');
            const progressContainer = document.getElementById('import-progress');
            const statusContainer = document.getElementById('import-status');
            const statusList = document.getElementById('import-status-list');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º UI
            progressContainer.classList.add('show');
            statusContainer.classList.remove('show');
            statusList.innerHTML = '';
            progressBar.style.width = '0%';
            
            try {
                // 1. –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–∞
                progressBar.style.width = '25%';
                showNotification('–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...', 'info');
                
                const xlsData = await parseXLSFile(file);
                progressBar.style.width = '50%';
                
                // 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                showNotification('–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'info');
                const processed = processXLSData(xlsData);
                progressBar.style.width = '75%';
                
                // 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö WMS
                wmsData = {
                    lastImportDate: new Date().toISOString(),
                    fileInfo: {
                        name: file.name,
                        size: file.size,
                        lastModified: file.lastModified
                    },
                    cellsData: processed.processedData
                };
                
                // 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫ warehousesData
                const applyResult = applyWMSDataToWarehouse();
                progressBar.style.width = '100%';
                
                // 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                saveData();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                if (isInspecting) {
                    updateInspectionCarousel();
                } else {
                    updateOverviewDisplay();
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                statusContainer.classList.add('show');
                
                const successItem = document.createElement('li');
                successItem.className = 'import-status-item';
                successItem.innerHTML = `<span>–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫:</span><span>${processed.stats.validRows}</span>`;
                statusList.appendChild(successItem);
                
                const errorItem = document.createElement('li');
                errorItem.className = 'import-status-item';
                errorItem.innerHTML = `<span>–°—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏:</span><span>${processed.stats.errorRows}</span>`;
                statusList.appendChild(errorItem);
                
                const updatedItem = document.createElement('li');
                updatedItem.className = 'import-status-item';
                updatedItem.innerHTML = `<span>–û–±–Ω–æ–≤–ª–µ–Ω–æ —è—á–µ–µ–∫ –≤ —Å–∏—Å—Ç–µ–º–µ:</span><span>${applyResult.updatedCells}</span>`;
                statusList.appendChild(updatedItem);
                
                const dateItem = document.createElement('li');
                dateItem.className = 'import-status-item';
                const importDate = new Date(wmsData.lastImportDate).toLocaleString();
                dateItem.innerHTML = `<span>–î–∞—Ç–∞ –∏–º–ø–æ—Ä—Ç–∞:</span><span>${importDate}</span>`;
                statusList.appendChild(dateItem);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
                if (processed.errors.length > 0) {
                    const errorsTitle = document.createElement('div');
                    errorsTitle.className = 'import-status-title';
                    errorsTitle.textContent = '–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:';
                    errorsTitle.style.marginTop = '10px';
                    errorsTitle.style.color = '#e74c3c';
                    statusContainer.appendChild(errorsTitle);
                    
                    const errorsList = document.createElement('ul');
                    errorsList.className = 'import-status-list';
                    
                    processed.errors.slice(0, 5).forEach(error => {
                        const errorItem = document.createElement('li');
                        errorItem.className = 'import-status-item';
                        errorItem.style.color = '#e74c3c';
                        errorItem.textContent = error;
                        errorsList.appendChild(errorItem);
                    });
                    
                    if (processed.errors.length > 5) {
                        const moreItem = document.createElement('li');
                        moreItem.className = 'import-status-item';
                        moreItem.style.color = '#7f8c8d';
                        moreItem.textContent = `... –∏ –µ—â—ë ${processed.errors.length - 5} –æ—à–∏–±–æ–∫`;
                        errorsList.appendChild(moreItem);
                    }
                    
                    statusContainer.appendChild(errorsList);
                }
                
                showNotification(`–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã! –û–±–Ω–æ–≤–ª–µ–Ω–æ ${applyResult.updatedCells} —è—á–µ–µ–∫`, 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                progressBar.style.backgroundColor = '#e74c3c';
                
                statusContainer.classList.add('show');
                const errorItem = document.createElement('li');
                errorItem.className = 'import-status-item';
                errorItem.style.color = '#e74c3c';
                errorItem.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                statusList.appendChild(errorItem);
                
                showNotification(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }

        // ========== –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–• –í CSV ==========
        function exportToCSV() {
            console.log('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV...');
            
            if (!warehousesData[currentAlley]) {
                showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
                return;
            }
            
            const operator = document.getElementById('operator-name').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const exportDate = new Date().toISOString();
            
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            let csvContent = '–ê–¥—Ä–µ—Å —è—á–µ–π–∫–∏;–°—Ç–∞—Ç—É—Å –≤ —Å–∏—Å—Ç–µ–º–µ;–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å;–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ;–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏;–û–ø–µ—Ä–∞—Ç–æ—Ä;–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\n';
            
            let exportedRows = 0;
            
            for (let sectionNum = 1; sectionNum <= totalSections; sectionNum++) {
                const section = sectionNum.toString().padStart(2, '0');
                const sectionData = warehousesData[currentAlley][section];
                
                if (!sectionData) continue;
                
                sectionData.cells.forEach(cell => {
                    if (cell.checked && cell.actualStatus !== 'skipped') {
                        const cellId = cell.id;
                        const systemStatus = cell.systemStatus;
                        const actualStatus = getActualStatusText(cell.actualStatus);
                        const discrepancy = cell.systemStatus === 'empty' && cell.actualStatus === 'discrepancy' ||
                                          cell.systemStatus === 'occupied' && cell.actualStatus === 'checked-empty' ? '–î–∞' : '–ù–µ—Ç';
                        const checkTime = cell.checkTime ? new Date(cell.checkTime).toLocaleString() : '';
                        const cellOperator = cell.operator || operator;
                        const comment = cell.comment || '';
                        
                        csvContent += `"${cellId}";"${systemStatus}";"${actualStatus}";"${discrepancy}";"${checkTime}";"${cellOperator}";"${comment}"\n`;
                        exportedRows++;
                    }
                });
            }
            
            if (exportedRows === 0) {
                showNotification('–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º Blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const fileName = `–æ—Ç—á–µ—Ç_${currentAlley}_${new Date().toISOString().slice(0,10).replace(/-/g,'')}_${new Date().getHours()}${new Date().getMinutes()}.csv`;
            
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${exportedRows} —Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª ${fileName}`, 'success');
        }

        function getActualStatusText(status) {
            switch(status) {
                case 'checked-empty': return '–ü—É—Å—Ç–∞—è';
                case 'discrepancy': return '–ó–∞–Ω—è—Ç–∞';
                case 'problem': return '–ü—Ä–æ–±–ª–µ–º–∞';
                default: return '–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞';
            }
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –†–ï–ñ–ò–ú–ê –û–ë–ó–û–†–ê ==========
        function updateOverviewDisplay() {
            updateOverviewAlleyTitle();
            updateGlobalStats();
            updateSectionsGrid();
        }

        function updateOverviewAlleyTitle() {
            document.getElementById('overview-alley-title').textContent = `–ê–ª–ª–µ—è ${currentAlley} - –°–µ–∫—Ü–∏–∏`;
        }

        function updateGlobalStats() {
            if (!warehousesData[currentAlley]) return;
            
            let total = 0;
            let checked = 0;
            let discrepancies = 0;
            let problems = 0;
            
            for (let sectionNum = 1; sectionNum <= totalSections; sectionNum++) {
                const section = sectionNum.toString().padStart(2, '0');
                if (warehousesData[currentAlley][section]) {
                    const cells = warehousesData[currentAlley][section].cells;
                    total += cells.length;
                    checked += cells.filter(cell => cell.checked && cell.actualStatus !== 'skipped').length;
                    discrepancies += cells.filter(cell => cell.actualStatus === 'discrepancy').length;
                    problems += cells.filter(cell => cell.actualStatus === 'problem').length;
                }
            }
            
            document.getElementById('total-cells').textContent = total;
            document.getElementById('checked-cells').textContent = checked;
            document.getElementById('discrepancy-cells').textContent = discrepancies;
            document.getElementById('problem-cells').textContent = problems;
        }

        function updateSectionsGrid() {
            const sectionsGrid = document.getElementById('sections-grid');
            if (!sectionsGrid) return;
            
            sectionsGrid.innerHTML = '';
            
            if (!warehousesData[currentAlley]) {
                sectionsGrid.innerHTML = '<div class="section-card">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
                return;
            }
            
            for (let sectionNum = 1; sectionNum <= totalSections; sectionNum++) {
                const section = sectionNum.toString().padStart(2, '0');
                const sectionData = warehousesData[currentAlley][section];
                if (!sectionData) continue;
                
                const cells = sectionData.cells;
                const total = cells.length;
                const checked = cells.filter(cell => cell.checked && cell.actualStatus !== 'skipped').length;
                const discrepancies = cells.filter(cell => cell.actualStatus === 'discrepancy').length;
                const problems = cells.filter(cell => cell.actualStatus === 'problem').length;
                const progress = total > 0 ? Math.round((checked / total) * 100) : 0;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ–∫—Ü–∏–∏
                let statusClass = 'status-not-started';
                let statusText = '–ù–µ –Ω–∞—á–∞—Ç–∞';
                
                if (progress === 100) {
                    statusClass = 'status-completed';
                    statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–∞';
                } else if (progress > 0 && progress < 100) {
                    statusClass = 'status-in-progress';
                    statusText = '–í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                }
                
                if (discrepancies > 0 || problems > 0) {
                    statusClass = 'status-with-issues';
                    statusText = '–ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã';
                }
                
                const sectionCard = document.createElement('div');
                sectionCard.className = `section-card`;
                sectionCard.dataset.sectionIndex = sectionNum - 1;
                
                sectionCard.innerHTML = `
                    <div class="section-card-header">
                        <div class="section-card-title">–°–µ–∫—Ü–∏—è ${section}</div>
                        <div class="section-card-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="section-card-stats">
                        <div class="section-card-stat">
                            <span class="section-card-stat-label">–í—Å–µ–≥–æ:</span>
                            <span class="section-card-stat-value">${total}</span>
                        </div>
                        <div class="section-card-stat">
                            <span class="section-card-stat-label">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:</span>
                            <span class="section-card-stat-value">${checked}</span>
                        </div>
                        <div class="section-card-stat">
                            <span class="section-card-stat-label">–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è:</span>
                            <span class="section-card-stat-value">${discrepancies}</span>
                        </div>
                        <div class="section-card-stat">
                            <span class="section-card-stat-label">–ü—Ä–æ–±–ª–µ–º—ã:</span>
                            <span class="section-card-stat-value">${problems}</span>
                        </div>
                    </div>
                    <div class="section-card-progress">
                        <div class="section-card-progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                // –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ - –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏
                sectionCard.addEventListener('click', () => {
                    currentSectionIndex = sectionNum - 1;
                    startInspection();
                });
                
                sectionsGrid.appendChild(sectionCard);
            }
        }

        // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –†–ï–ñ–ò–ú–û–í ==========
        function startInspection() {
            console.log('–ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–µ–∫—Ü–∏—è:', currentSectionIndex);
            isInspecting = true;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º—ã
            document.getElementById('overview-mode').style.display = 'none';
            document.getElementById('inspection-mode').style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('inspection-alley-title').textContent = `–ê–ª–ª–µ—è ${currentAlley} - –ü—Ä–æ–≤–µ—Ä–∫–∞`;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—É—Å–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏
            updateInspectionCarousel();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`–ù–∞—á–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–ª–µ–∏ ${currentAlley}`, 'info');
        }

        function exitInspection() {
            isInspecting = false;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º—ã
            document.getElementById('inspection-mode').style.display = 'none';
            document.getElementById('overview-mode').style.display = 'flex';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–∑–æ—Ä
            updateOverviewDisplay();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–ª–µ–∏ ${currentAlley} –∑–∞–≤–µ—Ä—à–µ–Ω–∞`, 'info');
        }

        // ========== –ö–ê–†–£–°–ï–õ–¨ –ü–†–û–í–ï–†–ö–ò ==========
        function updateInspectionCarousel() {
            const carousel = document.getElementById('sections-carousel');
            const indicators = document.getElementById('swipe-indicators');
            
            if (!carousel || !indicators) return;
            
            carousel.innerHTML = '';
            indicators.innerHTML = '';
            
            if (!warehousesData[currentAlley]) {
                carousel.innerHTML = '<div class="inspection-section-slide"><div style="text-align: center; padding: 40px; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div></div>';
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π
            for (let sectionNum = 1; sectionNum <= totalSections; sectionNum++) {
                const section = sectionNum.toString().padStart(2, '0');
                const slide = createInspectionSectionSlide(section, sectionNum - 1);
                carousel.appendChild(slide);
                
                // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                const indicator = document.createElement('div');
                indicator.className = `swipe-indicator ${sectionNum - 1 === currentSectionIndex ? 'active' : ''}`;
                indicator.dataset.index = sectionNum - 1;
                indicator.addEventListener('click', () => goToSection(sectionNum - 1));
                indicators.appendChild(indicator);
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞—Ä—É—Å–µ–ª–∏
            goToSection(currentSectionIndex);
        }

        function createInspectionSectionSlide(section, index) {
            const sectionData = warehousesData[currentAlley][section];
            if (!sectionData) {
                return createEmptySlide(section, index);
            }
            
            const cells = sectionData.cells;
            
            const slide = document.createElement('div');
            slide.className = 'inspection-section-slide';
            slide.dataset.sectionIndex = index;
            slide.dataset.section = section;
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —è—Ä—É—Å–æ–≤
            const rackContainer = document.createElement('div');
            rackContainer.className = 'inspection-rack';
            
            const cellsByTier = {};
            tierOrder.forEach(tier => {
                cellsByTier[tier] = cells.filter(cell => cell.tier === tier);
            });
            
            tierOrder.forEach(tier => {
                const tierCells = cellsByTier[tier];
                if (tierCells.length === 0) return;
                
                const tierRow = document.createElement('div');
                tierRow.className = 'inspection-tier-row';
                
                if (pickingTiers.includes(tier)) {
                    tierRow.classList.add('inspection-tier-picking');
                } else if (upperTiers.includes(tier)) {
                    tierRow.classList.add('inspection-tier-upper');
                }
                
                const tierLabel = document.createElement('div');
                tierLabel.className = 'inspection-tier-label';
                if (pickingTiers.includes(tier)) {
                    tierLabel.classList.add('picking');
                } else if (upperTiers.includes(tier)) {
                    tierLabel.classList.add('upper');
                }
                tierLabel.textContent = tier;
                tierRow.appendChild(tierLabel);
                
                const cellsContainer = document.createElement('div');
                cellsContainer.className = 'inspection-cells-container';
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —è—á–µ–π–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º
                tierCells.sort((a, b) => positions.indexOf(a.position) - positions.indexOf(b.position));
                
                tierCells.forEach(cell => {
                    const cellElement = createCellElement(cell);
                    cellsContainer.appendChild(cellElement);
                });
                
                tierRow.appendChild(cellsContainer);
                rackContainer.appendChild(tierRow);
            });
            
            slide.innerHTML = `
                <div class="inspection-section-header">
                    <div class="inspection-section-name">–°–µ–∫—Ü–∏—è ${section}</div>
                    <div class="inspection-section-counter">${index + 1}/${totalSections}</div>
                </div>
                <div class="inspection-rack-container">
                </div>
            `;
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º rackContainer –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            const rackContainerWrapper = slide.querySelector('.inspection-rack-container');
            if (rackContainerWrapper) {
                rackContainerWrapper.appendChild(rackContainer);
            }
            
            return slide;
        }

        function createCellElement(cell) {
            const cellElement = document.createElement('div');
            cellElement.className = 'inspection-cell';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —è—á–µ–π–∫–∏
            let statusClass = 'inspection-cell-unchecked';
            if (cell.checked) {
                if (cell.actualStatus === 'checked-empty') {
                    statusClass = 'inspection-cell-checked-empty';
                } else if (cell.actualStatus === 'discrepancy') {
                    statusClass = 'inspection-cell-discrepancy';
                } else if (cell.actualStatus === 'problem') {
                    statusClass = 'inspection-cell-problem';
                } else if (cell.actualStatus === 'skipped') {
                    statusClass = 'inspection-cell-skipped';
                }
            }
            
            cellElement.className = `inspection-cell ${statusClass}`;
            if (cell.actualStatus === 'discrepancy' || cell.actualStatus === 'problem') {
                cellElement.classList.add('pulse');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ WMS
            if (cell.systemStatus === 'occupied') {
                cellElement.style.borderLeft = '4px solid #e74c3c';
            } else if (cell.systemStatus === 'empty') {
                cellElement.style.borderLeft = '4px solid #2ecc71';
            }
            
            cellElement.dataset.cellId = cell.id;
            cellElement.dataset.alley = cell.alley;
            cellElement.dataset.section = cell.section;
            cellElement.dataset.tier = cell.tier;
            cellElement.dataset.position = cell.position;
            
            const cellAddress = document.createElement('div');
            cellAddress.className = 'inspection-cell-address';
            cellAddress.textContent = cell.position;
            
            const cellPosition = document.createElement('div');
            cellPosition.className = 'inspection-cell-position';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ WMS
            let statusIcon = '';
            if (cell.systemStatus === 'occupied') {
                statusIcon = 'üì¶';
            } else if (cell.systemStatus === 'empty') {
                statusIcon = '‚¨ú';
            }
            
            cellPosition.textContent = `${statusIcon} ${cell.position}`;
            
            cellElement.appendChild(cellAddress);
            cellElement.appendChild(cellPosition);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞/—Ç–∞–ø–∞
            cellElement.addEventListener('click', (e) => {
                e.stopPropagation();
                handleCellClick(cell, cellElement);
            });
            
            return cellElement;
        }

        function createEmptySlide(section, index) {
            const slide = document.createElement('div');
            slide.className = 'inspection-section-slide';
            slide.dataset.sectionIndex = index;
            
            slide.innerHTML = `
                <div class="inspection-section-header">
                    <div class="inspection-section-name">–°–µ–∫—Ü–∏—è ${section}</div>
                    <div class="inspection-section-counter">${index + 1}/${totalSections}</div>
                </div>
                <div class="inspection-rack-container">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–∫—Ü–∏–∏ ${section}
                    </div>
                </div>
            `;
            
            return slide;
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –°–ï–ö–¶–ò–Ø–ú ==========
        function goToSection(index) {
            if (index < 0 || index >= totalSections) return;
            
            currentSectionIndex = index;
            const carousel = document.getElementById('sections-carousel');
            if (carousel) {
                carousel.style.transform = `translateX(-${index * 100}%)`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            document.querySelectorAll('.swipe-indicator').forEach((ind, i) => {
                ind.classList.toggle('active', i === index);
            });
        }

        function nextSection() {
            if (currentSectionIndex < totalSections - 1) {
                goToSection(currentSectionIndex + 1);
            }
        }

        function prevSection() {
            if (currentSectionIndex > 0) {
                goToSection(currentSectionIndex - 1);
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ö–õ–ò–ö–û–í –ü–û –Ø–ß–ï–ô–ö–ê–ú ==========
        function handleCellClick(cell, cellElement) {
            console.log('–ö–ª–∏–∫ –ø–æ —è—á–µ–π–∫–µ:', cell.id);
            selectedCell = cell;
            selectedCellElement = cellElement;
            openModal(cell);
        }

        // ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ==========
        function openModal(cell) {
            console.log('–û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è:', cell.id);
            document.getElementById('modal-address').textContent = cell.id;
            document.getElementById('modal-overlay').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('show');
            selectedCell = null;
            selectedCellElement = null;
        }

        function updateCellStatus(status) {
            if (!selectedCell) {
                console.error('–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —è—á–µ–π–∫–∏');
                return;
            }
            
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —è—á–µ–π–∫–∏:', selectedCell.id, '—Å—Ç–∞—Ç—É—Å:', status);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –≤ warehousesData
            selectedCell.actualStatus = status;
            selectedCell.checked = true;
            selectedCell.checkTime = new Date().toISOString();
            selectedCell.operator = document.getElementById('operator-name').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ
            if ((selectedCell.systemStatus === 'empty' && status === 'discrepancy') ||
                (selectedCell.systemStatus === 'occupied' && status === 'checked-empty')) {
                selectedCell.discrepancy = true;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —è—á–µ–π–∫–∏
            if (selectedCellElement) {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
                selectedCellElement.classList.remove(
                    'inspection-cell-unchecked',
                    'inspection-cell-checked-empty',
                    'inspection-cell-discrepancy',
                    'inspection-cell-problem',
                    'inspection-cell-skipped',
                    'pulse'
                );
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å
                let newStatusClass = 'inspection-cell-unchecked';
                switch(status) {
                    case 'checked-empty':
                        newStatusClass = 'inspection-cell-checked-empty';
                        break;
                    case 'discrepancy':
                        newStatusClass = 'inspection-cell-discrepancy';
                        selectedCellElement.classList.add('pulse');
                        break;
                    case 'problem':
                        newStatusClass = 'inspection-cell-problem';
                        selectedCellElement.classList.add('pulse');
                        break;
                    case 'skipped':
                        newStatusClass = 'inspection-cell-skipped';
                        break;
                }
                
                selectedCellElement.classList.add(newStatusClass);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (isInspecting) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é —Å–µ–∫—Ü–∏—é –≤ –∫–∞—Ä—É—Å–µ–ª–∏
                const currentSection = (currentSectionIndex + 1).toString().padStart(2, '0');
                updateSectionIndicators(currentSection);
            } else {
                updateOverviewDisplay();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            let message = '';
            let type = 'info';
            
            switch(status) {
                case 'checked-empty':
                    message = `–Ø—á–µ–π–∫–∞ ${selectedCell.id} –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –ø—É—Å—Ç–∞—è`;
                    type = 'success';
                    break;
                case 'discrepancy':
                    message = `–Ø—á–µ–π–∫–∞ ${selectedCell.id} –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –∑–∞–Ω—è—Ç–∞—è (–†–ê–°–•–û–ñ–î–ï–ù–ò–ï!)`;
                    type = 'warning';
                    break;
                case 'problem':
                    message = `–Ø—á–µ–π–∫–∞ ${selectedCell.id} –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è`;
                    type = 'info';
                    break;
                case 'skipped':
                    message = `–Ø—á–µ–π–∫–∞ ${selectedCell.id} –ø—Ä–æ–ø—É—â–µ–Ω–∞`;
                    type = 'info';
                    break;
            }
            
            showNotification(message, type);
            closeModal();
        }

        function updateSectionIndicators(section) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Å–µ–∫—Ü–∏–∏ –≤ —Ä–µ–∂–∏–º–µ –æ–±–∑–æ—Ä–∞
            const sectionCard = document.querySelector(`.section-card[data-section-index="${currentSectionIndex}"]`);
            if (sectionCard) {
                const sectionData = warehousesData[currentAlley][section];
                if (sectionData) {
                    const cells = sectionData.cells;
                    const total = cells.length;
                    const checked = cells.filter(cell => cell.checked && cell.actualStatus !== 'skipped').length;
                    const discrepancies = cells.filter(cell => cell.actualStatus === 'discrepancy').length;
                    const problems = cells.filter(cell => cell.actualStatus === 'problem').length;
                    const progress = total > 0 ? Math.round((checked / total) * 100) : 0;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
                    const stats = sectionCard.querySelectorAll('.section-card-stat-value');
                    if (stats.length >= 4) {
                        stats[0].textContent = total;
                        stats[1].textContent = checked;
                        stats[2].textContent = discrepancies;
                        stats[3].textContent = problems;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                    const progressFill = sectionCard.querySelector('.section-card-progress-fill');
                    if (progressFill) {
                        progressFill.style.width = `${progress}%`;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    const statusElement = sectionCard.querySelector('.section-card-status');
                    if (statusElement) {
                        let statusClass = 'status-not-started';
                        let statusText = '–ù–µ –Ω–∞—á–∞—Ç–∞';
                        
                        if (progress === 100) {
                            statusClass = 'status-completed';
                            statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–∞';
                        } else if (progress > 0 && progress < 100) {
                            statusClass = 'status-in-progress';
                            statusText = '–í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                        }
                        
                        if (discrepancies > 0 || problems > 0) {
                            statusClass = 'status-with-issues';
                            statusText = '–ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã';
                        }
                        
                        statusElement.className = `section-card-status ${statusClass}`;
                        statusElement.textContent = statusText;
                    }
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateGlobalStats();
        }

        // ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ==========
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type, 'show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
        function setupEventListeners() {
            // –í—ã–±–æ—Ä –∞–ª–ª–µ–∏ –≤ —Ä–µ–∂–∏–º–µ –æ–±–∑–æ—Ä–∞
            document.getElementById('alley-select').addEventListener('change', function() {
                currentAlley = this.value;
                currentSectionIndex = 0;
                updateOverviewDisplay();
                showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∞–ª–ª–µ—è ${currentAlley}`, 'info');
            });
            
            // –ö–Ω–æ–ø–∫–∞ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
            document.getElementById('start-inspection-btn').addEventListener('click', startInspection);
            
            // –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ XLS
            document.getElementById('import-btn').addEventListener('click', openImportModal);
            
            // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV
            document.getElementById('export-btn').addEventListener('click', exportToCSV);
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            document.getElementById('exit-inspection-btn').addEventListener('click', exitInspection);
            
            // –ò–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
            const operatorNameInput = document.getElementById('operator-name');
            operatorNameInput.addEventListener('change', function() {
                localStorage.setItem('warehouseOperator', this.value);
                showNotification('–ò–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'info');
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
            const savedOperator = localStorage.getItem('warehouseOperator');
            if (savedOperator) {
                operatorNameInput.value = savedOperator;
            }
            
            // –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∫–∞—Ä—É—Å–µ–ª–∏
            document.getElementById('carousel-prev').addEventListener('click', prevSection);
            document.getElementById('carousel-next').addEventListener('click', nextSection);
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–ø—Ü–∏–π
            document.querySelectorAll('.modal-option').forEach(option => {
                option.addEventListener('click', function() {
                    const status = this.getAttribute('data-status');
                    console.log('–í—ã–±—Ä–∞–Ω —Å—Ç–∞—Ç—É—Å:', status);
                    updateCellStatus(status);
                });
            });
            
            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
            document.getElementById('modal-cancel').addEventListener('click', closeModal);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
            document.getElementById('modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            // –ò–º–ø–æ—Ä—Ç: Drag & Drop
            const dropzone = document.getElementById('import-dropzone');
            const fileInput = document.getElementById('xls-file-input');
            
            dropzone.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
            
            // Drag & Drop —Å–æ–±—ã—Ç–∏—è
            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.classList.add('dragover');
            });
            
            dropzone.addEventListener('dragleave', () => {
                dropzone.classList.remove('dragover');
            });
            
            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
            
            // –ö–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–º–ø–æ—Ä—Ç–∞
            document.getElementById('import-start-btn').addEventListener('click', startImport);
            document.getElementById('import-cancel-btn').addEventListener('click', closeImportModal);
            document.getElementById('clear-file-btn').addEventListener('click', resetImportForm);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
            document.getElementById('import-modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeImportModal();
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    closeImportModal();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setupSwipeHandlers();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', function() {
                isMobile = window.innerWidth < 768;
                
                // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å
                if (isInspecting) {
                    updateInspectionCarousel();
                }
            });
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –°–í–ê–ô–ü–û–í ==========
        function setupSwipeHandlers() {
            const carouselContainer = document.getElementById('carousel-container');
            if (!carouselContainer) return;
            
            let touchStartX = 0;
            let touchEndX = 0;
            const minSwipeDistance = 50;
            
            carouselContainer.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });
            
            carouselContainer.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                const swipeDistance = touchEndX - touchStartX;
                
                if (Math.abs(swipeDistance) > minSwipeDistance) {
                    if (swipeDistance > 0) {
                        // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ -> –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å–µ–∫—Ü–∏—è
                        prevSection();
                    } else {
                        // –°–≤–∞–π–ø –≤–ª–µ–≤–æ -> —Å–ª–µ–¥—É—é—â–∞—è —Å–µ–∫—Ü–∏—è
                        nextSection();
                    }
                }
            }
        }
    </script>
</body>
</html>